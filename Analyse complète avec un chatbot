pip install pandas sqlalchemy scikit-learn openai tabulate


import pandas as pd
import sqlalchemy
from sklearn.impute import SimpleImputer
from tabulate import tabulate
import openai

# ğŸ‘‰ Configurez votre clÃ© API OpenAI si vous souhaitez des recommandations GPT
openai.api_key = "YOUR_OPENAI_API_KEY"

# --- Connexion Ã  la base de donnÃ©es ---
def load_data(db_url, table_name):
    engine = sqlalchemy.create_engine(db_url)
    df = pd.read_sql_table(table_name, con=engine)
    return df

# --- Analyse Exploratoire de base ---
def basic_profiling(df):
    print("\nğŸ“Š AperÃ§u des donnÃ©es :")
    print(tabulate(df.head(), headers='keys', tablefmt='grid'))

    print("\nğŸ§¾ Info des colonnes :")
    print(df.info())

    print("\nğŸ“‰ Statistiques descriptives :")
    print(df.describe(include='all'))

# --- ProblÃ¨mes potentiels ---
def identify_problems(df):
    report = {}

    missing = df.isnull().sum()
    report["missing_values"] = missing[missing > 0]

    duplicated = df.duplicated().sum()
    report["duplicates"] = duplicated

    skewness = df.select_dtypes(include='number').skew()
    report["skewness"] = skewness[abs(skewness) > 1]

    return report

# --- Recommandations GPT (optionnel) ---
def generate_recommendations(report):
    prompt = f"""
    Voici un rapport d'analyse de donnÃ©es contenant des problÃ¨mes dÃ©tectÃ©s :
    {report}

    Fournis des recommandations prÃ©cises et actionnables pour rÃ©soudre chaque problÃ¨me.
    """

    try:
        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.4
        )
        return response['choices'][0]['message']['content']
    except Exception as e:
        return f"Erreur lors de l'appel GPT : {e}"

# --- Interface Chatbot CLI ---
def chatbot():
    print("ğŸ¤– Bienvenue dans le Chatbot Data Analyst.")
    db_url = input("ğŸ”— Entrez l'URL de la base de donnÃ©es (ex: sqlite:///mydb.db) : ")
    table_name = input("ğŸ“‚ Entrez le nom de la table Ã  analyser : ")

    try:
        df = load_data(db_url, table_name)
    except Exception as e:
        print(f"Erreur lors du chargement de la base : {e}")
        return

    while True:
        print("\nQue souhaitez-vous faire ?")
        print("1. Profilage de base")
        print("2. Identifier les problÃ¨mes")
        print("3. Recommandations GPT")
        print("4. Quitter")
        choix = input("â¡ Votre choix : ")

        if choix == '1':
            basic_profiling(df)
        elif choix == '2':
            problems = identify_problems(df)
            print("\nğŸ” ProblÃ¨mes dÃ©tectÃ©s :")
            for key, val in problems.items():
                print(f"\nğŸ›  {key} :")
                print(val)
        elif choix == '3':
            problems = identify_problems(df)
            recommandations = generate_recommendations(problems)
            print("\nğŸ’¡ Recommandations :")
            print(recommandations)
        elif choix == '4':
            print("ğŸ‘‹ Fin de session.")
            break
        else:
            print("âŒ Choix invalide.")

# --- Lancer le chatbot ---
if __name__ == "__main__":
    chatbot()
